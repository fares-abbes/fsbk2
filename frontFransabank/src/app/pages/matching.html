<div class="page-container">
  <!-- Page Header -->
  <div class="page-header-section">
    <h1 class="page-title">Matching & Accounting</h1>
    <p class="page-subtitle">Process transaction matching, generate accounting entries, and manage data cleanup</p>
  </div>

  <!-- Stats Overview -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon primary">
        <i class="pi pi-sync"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ matchingRows.length }}</span>
        <span class="stat-label">Matching Processes</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon success">
        <i class="pi pi-check"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value">1</span>
        <span class="stat-label">Completed Today</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon info">
        <i class="pi pi-exchange"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ fileExchangeRows.length }}</span>
        <span class="stat-label">Exchange Actions</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon warning">
        <i class="pi pi-book"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value">{{ dayOpRows.length + mouvementRows.length }}</span>
        <span class="stat-label">Accounting Entries</span>
      </div>
    </div>
  </div>

  <!-- Tab View -->
  <p-tabs [(value)]="activeTabIndex" styleClass="modern-tabview">
    <p-tablist>
      <p-tab [value]="0">
        <i class="pi pi-sync tab-icon"></i>
        <span>Matching</span>
      </p-tab>
      <p-tab [value]="1">
        <i class="pi pi-book tab-icon"></i>
        <span>Écriture Comptable</span>
      </p-tab>
      <p-tab [value]="2">
        <i class="pi pi-trash tab-icon"></i>
        <span>Suppression</span>
      </p-tab>
    </p-tablist>

    <p-tabpanels>
      <!-- Matching Tab -->
      <p-tabpanel [value]="0">
        <div class="tab-content">
        <!-- Matching Processes Card -->
        <section class="card">
          <div class="card-header">
            <div class="card-title-wrapper">
              <h2 class="card-title">
                <span class="card-title-icon"><i class="pi pi-sync"></i></span>
                Transaction Matching
              </h2>
              <p class="card-description">Match incoming transactions with bank records</p>
            </div>
          </div>

          <p-table 
            [value]="matchingRows" 
            [tableStyle]="{ 'min-width': '50rem' }"
            styleClass="p-datatable-sm"
            [rowHover]="true"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>Process</th>
                <th>Status</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th style="width: 140px">Actions</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-row>
              <tr>
                <td>
                  <div class="process-name">
                    <i class="pi pi-cog"></i>
                    <span>{{ row.name }}</span>
                  </div>
                </td>
                <td>
                  <p-tag 
                    [value]="row.status" 
                    [severity]="getStatusSeverity(row.status)"
                    [icon]="getStatusIcon(row.status)"
                  />
                </td>
                <td class="date-cell">{{ row.startDate }}</td>
                <td class="date-cell">{{ row.endDate }}</td>
                <td>
                  <p-button 
                    icon="pi pi-play" 
                    label="Match" 
                    severity="success"
                    size="small"
                    [disabled]="isMatchingDisabled(row)"
                    (onClick)="onRunMatching(row)"
                    pTooltip="Run matching process"
                  />
                </td>
              </tr>
            </ng-template>
          </p-table>
        </section>

        <!-- Batch Exchange Card -->
        <section class="card">
          <div class="card-header">
            <div class="card-title-wrapper">
              <h2 class="card-title">
                <span class="card-title-icon"><i class="pi pi-exchange"></i></span>
                Batch Exchange Actions
              </h2>
              <p class="card-description">Send and receive batch files for processing</p>
            </div>
          </div>

          <p-table 
            [value]="fileExchangeRows" 
            [tableStyle]="{ 'min-width': '50rem' }"
            styleClass="p-datatable-sm"
            [rowHover]="true"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>Action Name</th>
                <th>Type</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th style="width: 140px">Actions</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-row>
              <tr>
                <td>
                  <div class="process-name">
                    <i [class]="getActionIcon(row.action)"></i>
                    <span>{{ row.name }}</span>
                  </div>
                </td>
                <td>
                  <p-tag 
                    [value]="row.action" 
                    [severity]="getActionSeverity(row.action)"
                    [icon]="getActionIcon(row.action)"
                  />
                </td>
                <td class="date-cell">{{ row.startDate }}</td>
                <td class="date-cell">{{ row.endDate }}</td>
                <td>
                  <p-button 
                    [icon]="getActionIcon(row.action)" 
                    [label]="row.action" 
                    [severity]="getActionSeverity(row.action)"
                    size="small"
                    (onClick)="onRunExchange(row)"
                    [pTooltip]="row.action === 'Send' ? 'Send batch file' : 'Retrieve batch file'"
                  />
                </td>
              </tr>
            </ng-template>
          </p-table>
        </section>
      </div>
      </p-tabpanel>

      <!-- Écriture Comptable Tab -->
      <p-tabpanel [value]="1">
        <div class="tab-content">
          <!-- Day OP Card -->
        <section class="card">
          <div class="card-header">
            <div class="card-title-wrapper">
              <h2 class="card-title">
                <span class="card-title-icon"><i class="pi pi-calendar"></i></span>
                Day OP
              </h2>
              <p class="card-description">Daily operational accounting entries</p>
            </div>
            <p-button 
              icon="pi pi-play" 
              label="Run Day OP" 
              severity="success"
              (onClick)="onRunDayOp()"
            />
          </div>

          <p-table 
            [value]="dayOpRows" 
            [tableStyle]="{ 'min-width': '50rem' }"
            styleClass="p-datatable-sm"
            [rowHover]="true"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>Process</th>
                <th>Status</th>
                <th>Start Date</th>
                <th>End Date</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-row>
              <tr>
                <td>
                  <div class="process-name">
                    <i class="pi pi-file-edit"></i>
                    <span>{{ row.name }}</span>
                  </div>
                </td>
                <td>
                  <p-tag 
                    [value]="row.status" 
                    [severity]="getStatusSeverity(row.status)"
                    [icon]="getStatusIcon(row.status)"
                  />
                </td>
                <td class="date-cell">{{ row.startDate }}</td>
                <td class="date-cell">{{ row.endDate }}</td>
              </tr>
            </ng-template>
          </p-table>
        </section>

        <!-- Mouvement & Archivage Card -->
        <section class="card">
          <div class="card-header">
            <div class="card-title-wrapper">
              <h2 class="card-title">
                <span class="card-title-icon"><i class="pi pi-database"></i></span>
                Mouvement & Archivage
              </h2>
              <p class="card-description">Transaction movements and archive operations</p>
            </div>
            <p-button 
              icon="pi pi-play" 
              label="Run Mouvement & Archivage" 
              severity="success"
              (onClick)="onRunMouvement()"
            />
          </div>

          <p-table 
            [value]="mouvementRows" 
            [tableStyle]="{ 'min-width': '50rem' }"
            styleClass="p-datatable-sm"
            [rowHover]="true"
          >
            <ng-template pTemplate="header">
              <tr>
                <th>Process</th>
                <th>Status</th>
                <th>Start Date</th>
                <th>End Date</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-row>
              <tr>
                <td>
                  <div class="process-name">
                    <i class="pi pi-arrow-right-arrow-left"></i>
                    <span>{{ row.name }}</span>
                  </div>
                </td>
                <td>
                  <p-tag 
                    [value]="row.status" 
                    [severity]="getStatusSeverity(row.status)"
                    [icon]="getStatusIcon(row.status)"
                  />
                </td>
                <td class="date-cell">{{ row.startDate }}</td>
                <td class="date-cell">{{ row.endDate }}</td>
              </tr>
            </ng-template>
          </p-table>
        </section>
      </div>
      </p-tabpanel>

      <!-- Suppression Tab -->
      <p-tabpanel [value]="2">
        <div class="tab-content">
          <section class="card deletion-card">
            <div class="card-header">
              <div class="card-title-wrapper">
                <h2 class="card-title">
                  <span class="card-title-icon danger"><i class="pi pi-trash"></i></span>
                  Data Cleanup
                </h2>
                <p class="card-description">Remove processed data for a specific date</p>
              </div>
            </div>

            <div class="info-box">
              <i class="pi pi-info-circle info-box-icon"></i>
              <span>Select a date to clear all associated transaction data. This action cannot be undone.</span>
            </div>

            <div class="deletion-form">
              <div class="form-group">
                <label class="form-label">Select Date to Clear Data</label>
                <p-datepicker 
                [(ngModel)]="selectedClearDate" 
                [showIcon]="true"
                dateFormat="dd/mm/yy"
                placeholder="Select a date"
                [style]="{ width: '100%' }"
              />
            </div>
            <p-button 
              icon="pi pi-trash" 
              label="Clear Data" 
              severity="danger"
              [disabled]="!selectedClearDate"
              (onClick)="onClearData()"
            />
          </div>

          <div class="warning-box">
            <i class="pi pi-exclamation-triangle warning-box-icon"></i>
            <div class="warning-content">
              <strong>Warning</strong>
              <p>Deleting data is permanent and cannot be recovered. Please ensure you have proper backups before proceeding.</p>
            </div>
          </div>
        </section>
      </div>
      </p-tabpanel>
    </p-tabpanels>
  </p-tabs>
</div>
